LOAD CSV WITH HEADERS FROM "file:///all_cities.csv" as cities 
create (c1:City {cid: cities.cid, city: cities.city, capital: cities.capital, population: cities.population, stationID: cities.stationID})

:auto USING PERIODIC COMMIT 500 LOAD CSV WITH HEADERS FROM "file:///temperature.csv" as temperature 
create (t1:Temperature {tid: temperature.tid, stationID: temperature.stationID, date: temperature.Date, average_temp: temperature.average_temp, max_temp: temperature.max_temp, min_temp: temperature.min_temp})

:auto USING PERIODIC COMMIT 500 LOAD CSV WITH HEADERS FROM "file:///weather_conditions.csv" as weather 
create (w1:Weather {wid: weather.wid, stationID: weather.stationID, date: weather.Date, precipitation: weather.precipitation, snowfall: weather.snowfall, snow_depth: weather.snow_depth})

CALL apoc.periodic.iterate("
MATCH (c1:City)
MATCH (t1:Temperature)
WHERE c1.stationID=t1.stationID
RETURN c1, t1
", "
CREATE (c1)-[:HAS]->(t1)
", {batchSize: 10000, parallel:true}
)

CALL apoc.periodic.iterate("
MATCH (c1:City)
MATCH (w1:Weather)
WHERE c1.stationID=w1.stationID
RETURN c1, w1
", "
CREATE (c1)-[:HAS]->(w1)
", {batchSize: 10000, parallel:true}
)
